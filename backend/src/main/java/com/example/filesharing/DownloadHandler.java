package com.example.filesharing;import com.example.filesharing.Model.FileInfo;import com.sun.net.httpserver.HttpExchange;import com.sun.net.httpserver.HttpHandler;import java.io.*;import java.time.Duration;public class DownloadHandler implements HttpHandler {    @Override    public void handle(HttpExchange exchange) throws IOException {        String uri = exchange.getRequestURI().toString(); // /download/{token}        String[] parts = uri.split("/");        if (parts.length != 3) {            exchange.sendResponseHeaders(400, -1);            return;        }        String token = parts[2];        FileInfo info = Storage.downloadMap.get(token);        if (info == null || info.downloaded || isExpired(info.uploadTime)) {            exchange.sendResponseHeaders(404, -1);            return;        }        File file = new File(info.fileName);        if (!file.exists()) {            exchange.sendResponseHeaders(404, -1);            return;        }        exchange.getResponseHeaders().add("Content-Type", "application/octet-stream");        exchange.getResponseHeaders().add("Content-Disposition", "attachment; filename=\"" + file.getName() + "\"");        exchange.sendResponseHeaders(200, file.length());        try (OutputStream os = exchange.getResponseBody();             InputStream is = new FileInputStream(file)) {            is.transferTo(os);        }        info.downloaded = true;    }    private boolean isExpired(long uploadTime) {        return System.currentTimeMillis() - uploadTime > Duration.ofDays(30).toMillis();    }}